<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mooresville| Blog</title>

    <!-- <link rel="stylesheet" href="../css/style.css"> -->
    <link rel="stylesheet" href="dashboards.css">
    <link rel="stylesheet" href="css/font/all.css">
    <script src="../js/funcoes.js"></script>
    <script src="./config/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    



    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- scripts do Chart.js -->
    <script type="text/javascript" src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>

</head>

<body>
    <!-- onload="validarSessao(), atualizarFeed()" -->
    <header>
        <div class="container1">
            <div class="menu">
                <center>
                    <ul>
                        <li>
                            <a href="dashboard.html">BlOG</a>
                        </li>

                        <li>
                            <input class="not" type="" name=""> <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                        <li>
                            <div class="btn-logout" onclick="limparSessao()">
                                <h3>pesquisar</h3>
                            </div>
                        </li>
                        <li>
                            <div class="btn-logout" onclick="limparSessao()">
                                <h3>Sair</h3>
                            </div>
                        </li>

                    </ul>
                </center>

            </div>
        </div>
    </header>
    <div class="banner">
        <div class="container"></div>
        <center><img  src="mooresville-logo-removebg-preview.png" alt=""></center>
    </div><br><br>
    </div>
    <section class="box-captura">
        </div>
        <div class="container1">
            <div class="wrapper-captura">
                <div class="box-single-chamada">
                    <h3 >Baixe Mooresville gratuitamente!</h3>
                </div>

                <div class="box-single-captura">
                    <a class="far-fa" href="./jogo/Mooresville.rar" download>Baixar agora!</a>
                    <p style="margin-left: 20px;">100% livre de span <i class="fas fa-arrow-right"></i></p>
                </div>
            </div>
        </div>
        <div class="clear"></div>
    </section>

    <section class="content">
        <article class="centraliza-container" id="bateria">
            <center>
                <h2 style="margin-top: 20px;">A História</h2>
            </center><br><br>
            <center><img src="Office.jpg" alt=""></center><br>
            <p class="texto-esquerda"> Mooresville é uma cidade real no condado de Limestone, norte do Alabama e possui apenas 67 habitantes, é uma pacata cidade em um dos mais cômicos 
                Estados americanos. A cidade possui um grande background histórico, principalmente por ter sido palco da guerra de secessão. Foi escolhida como palco para a história do Grupo Urano, não só por ser uma cidade histórica, mais por seu posicionamento geográfico e por ser extremamente pacata, afinal, quem iria procurar nosso protagonista em <b> Mooresville, Alabama</b><span id="reticencias">...</span></p><br><span id="mostrar">
                <p class="texto-esquerda"></p><br>
                <br>
                -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                <center>
                    <h3>Conheça a história</h3>
                </center>
                <p>-Aqui você pode baixar e ler a história em que o jogo foi baseado.</p><br>

                <a href="Mooresville Wilson cut-1.pdf" download>Baixar PDF</a><br><br>
                <h3>Dicas para jogar</h3>
                <p> 1- Não se esqueça de verificar se está digitando as opções corretamente dentro do jogo para evitar problemar</p><br><br>
        <p>2- Suas decisões afetam a continuidade do jogo, então pense bem antes de tomá-las, pois elas certamente podem te levar a morte e a perca total do seu progresso no jogo</p><br><br>
        <p>3- Apesar de o jogo ser baseado em uma história linear, sua escolhas podem te levar a um final... diferente</p><br><br>
        <p>4- Não se esqueça de se divertir muito, e tome cuidado com os "Animais".</p><b><br></b>

            </span>
            <button id="btn1" onclick="leiaMais()">Leia Mais</button>
        </article><br>
        
        <div>
          <center><h3>Melhores pontuadores do blog</h3> </center>
  <canvas  style ="width: 50vw; height: 25vh;"id="myChart"></canvas>
      </div>
    </section>

    <div class="footer">
        <div class="container">
        
                <h4>Todos os direitos reservados&copy; Equipe Urano 2022</h4>
            
            <h6></h6>
        </div>
    </div>
    </div>

</body>

</html>

<script>
 const labels = [
    'HunterBR',
    'illinoisguy',
    'zéfire',
    'proDutra',
    'Cyrax',
    'Stalin',
    'GVRO',
  ];

  const data = {
    labels: labels,
    datasets: [{
      label: '',
      backgroundColor: 'black',
      borderColor: 'black',
      data: [1500, 1200, 900, 765, 400, 250, 190],
    }]
  };

  const config = {
    type: 'bar',
    data: data,
    options: {}
  };
  const myChart = new Chart(
    document.getElementById('myChart'),
    config
  );

    let proximaAtualizacao;
    function leiaMais() {
        var reticencias = document.getElementById("reticencias");
        var mostrar = document.getElementById("mostrar");
        var btn1 = document.getElementById("btn1");

        if (reticencias.style.display === "none") {
            reticencias.style.display = "inline"
            mostrar.style.display = "none"
            btn1.innerHTML = "Leia Mais"
        } else {
            reticencias.style.display = "none"
            mostrar.style.display = "inline"
            btn1.innerHTML = "Leia Menos"
        }
    }
    function leiaMais1() {
        var reticencias = document.getElementById("reticencias1");
        var mostrar = document.getElementById("mostrar1");
        var btn2 = document.getElementById("btn2");

        if (reticencias.style.display === "none") {
            reticencias.style.display = "inline"
            mostrar.style.display = "none"
            btn2.innerHTML = "Leia Mais"
        } else {
            reticencias.style.display = "none"
            mostrar.style.display = "inline"
            btn2.innerHTML = "Leia Menos"
        }
    }
    function leiaMais2() {
        var reticencias = document.getElementById("reticencias2");
        var mostrar = document.getElementById("mostrar2");
        var btn3 = document.getElementById("btn3");

        if (reticencias.style.display === "none") {
            reticencias.style.display = "inline"
            mostrar.style.display = "none"
            btn3.innerHTML = "Leia Mais"
        } else {
            reticencias.style.display = "none"
            mostrar.style.display = "inline"
            btn3.innerHTML = "Leia Menos"
        }
    }
    function leiaMais3() {
        var reticencias = document.getElementById("reticencias3");
        var mostrar = document.getElementById("mostrar3");
        var btn4 = document.getElementById("btn4");

        if (reticencias.style.display === "none") {
            reticencias.style.display = "inline"
            mostrar.style.display = "none"
            btn3.innerHTML = "Leia Mais"
        } else {
            reticencias.style.display = "none"
            mostrar.style.display = "inline"
            btn3.innerHTML = "Leia Menos"
        }
    }
    window.onload = obterDadosGrafico(1);

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    verificar_autenticacao();

    function alterarTitulo(idAquario) {
        var tituloAquario = document.getElementById("tituloAquario")
        tituloAquario.innerHTML = "Últimas medidas de Temperatura e Umidade do <span style='color: #e6005a'>Aquário " + idAquario + "</span>"
    }

    // O gráfico é construído com três funções:
    // 1. obterDadosGrafico -> Traz dados do Banco de Dados para montar o gráfico da primeira vez
    // 2. plotarGrafico -> Monta o gráfico com os dados trazidos e exibe em tela
    // 3. atualizarGrafico -> Atualiza o gráfico, trazendo novamente dados do Banco

    // Esta função *obterDadosGrafico* busca os últimos dados inseridos em tabela de medidas.
    // para, quando carregar o gráfico da primeira vez, já trazer com vários dados.
    // A função *obterDadosGrafico* também invoca a função *plotarGrafico*

    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models
    function obterDadosGrafico(idAquario) {
        alterarTitulo(idAquario)

        if (proximaAtualizacao != undefined) {
            clearTimeout(proximaAtualizacao);
        }

        fetch(`/medidas/ultimas/${idAquario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico(resposta, idAquario);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função *plotarGrafico* também invoca a função *atualizarGrafico*
    function plotarGrafico(resposta, idAquario) {
        console.log('iniciando plotagem do gráfico...');
       
        var dados = {
            labels: [],
            datasets: [
                {
                    yAxisID: 'y-umidade',
                    label: 'Umidade',
                    borderColor: '#32B9CD',
                    backgroundColor: '#32b9cd8f',
                    fill: true,
                    data: []
                },
                {
                    yAxisID: 'y-temperatura',
                    label: 'Temperatura',
                    borderColor: '#FFF',
                    backgroundColor: '#32b9cd8f',
                    fill: true,
                    data: []
                }
            ]
        };

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            dados.labels.push(registro.momento_grafico);
            dados.datasets[0].data.push(registro.umidade);
            dados.datasets[1].data.push(registro.temperatura);
        }

        console.log(JSON.stringify(dados));
        var contextoLm35Temperatura = document.getElementById('lm35Temperatura').getContext('2d');
        contextoLm35Temperatura.canvas.width = 1000;
        contextoLm35Temperatura.canvas.height = 300;
        var lm35Temperatura = new Chart(
            contextoLm35Temperatura,
            {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Temperatura',
                        type: 'line',
                        borderColor: ['#222'],
                        backgroundColor: ['#287bff'],
                    }]
                },
                options: {
                    scales: {
                        xAxes: [{
                            distribution: 'series',
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Temperatura'
                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    animation: {
                        duration: 0
                    }
                }
            }
        );


        setTimeout(() => atualizarGrafico(idAquario, dados), 2000);
    }


    // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
    // buscando a última medida inserida em tabela contendo as capturas, 

    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models
    function atualizarGrafico(idAquario, dados) {

        fetch(`/medidas/tempo-real/${idAquario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {

                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico: ${dados}`);

                    // tirando e colocando valores no gráfico
                    dados.labels.shift(); // apagar o primeiro
                    dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

                    dados.datasets[0].data.shift();  // apagar o primeiro de umidade
                    dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade

                    dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
                    dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

                    window.grafico_linha.update();

                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados), 2000);
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

    }
</script>